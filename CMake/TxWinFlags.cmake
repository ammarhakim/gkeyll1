#
# Include for common Windows flags and settings.
#
# $Id: TxWinFlags.cmake 162 2010-11-23 23:41:03Z mkoch $
#
######################################################################

IF(WIN32)
# ICL needs to be defined here (Intel compiler and Visual Studio) for
# trilinos: ml_utils.h
  ADD_DEFINITIONS(-DWIN32 -DICL)
  SET(_TIMEVAL_DEFINED 1
    CACHE STRING "Define whether system has timeval (for Windows)")
  SET(_USE_MATH_DEFINES 1
    CACHE STRING "Define whether to use math defines (for Windows)")
  IF(DEBUG_CMAKE)
    MESSAGE("CMAKE_C_COMPILER = ${CMAKE_C_COMPILER}.")
  ENDIF()
  STRING(REGEX MATCH "^.*icl\\.*" USING_ICL "${CMAKE_C_COMPILER}")
  # MESSAGE("USING_ICL = ${USING_ICL}.")
  STRING(REGEX MATCH "^.*cl\\.*" USING_CL "${CMAKE_C_COMPILER}")
  # MESSAGE("USING_CL = ${USING_CL}.")
  IF(USING_ICL)
    # MESSAGE("USING_ICL is true.")
    IF(NOT BUILD_SHARED_LIBS AND NOT BUILD_WITH_SHARED_RUNTIME)
      SET(CMAKE_CXX_FLAGS_DEBUG "/MTd /Z7 /Od")
      SET(CMAKE_CXX_FLAGS_RELEASE "/MT /O2")
      SET(CMAKE_CXX_FLAGS_MINSIZEREL "/MT /O2")
      SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/MTd /Z7 /Od")
      SET(CMAKE_C_FLAGS_DEBUG "/MTd /Z7 /Od")
      SET(CMAKE_C_FLAGS_RELEASE "/MT /O2")
      SET(CMAKE_C_FLAGS_MINSIZEREL "/MT /O2")
      SET(CMAKE_C_FLAGS_RELWITHDEBINFO "/MTd /Z7 /Od")
      FOREACH(i DEBUG RELEASE MINSIZERELEASE REWITHDEBINFO)
        SET(CMAKE_C_FLAGS_${i} "${CMAKE_C_FLAGS_${i}} /Qstd:c99")
      ENDFOREACH()
    ELSE()
      SET(CMAKE_CXX_FLAGS_DEBUG "/MDd /Z7 /Od")
      SET(CMAKE_CXX_FLAGS_RELEASE "/MD /O2")
      SET(CMAKE_CXX_FLAGS_MINSIZEREL "/MD /O2")
      SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/MDd /Z7 /Od")
      SET(CMAKE_C_FLAGS_DEBUG "/MDd /Z7 /Od")
      SET(CMAKE_C_FLAGS_RELEASE "/MD /O2")
      SET(CMAKE_C_FLAGS_MINSIZEREL "/MD /O2")
      SET(CMAKE_C_FLAGS_RELWITHDEBINFO "/MDd /Z7 /Od")
      FOREACH(i DEBUG RELEASE MINSIZERELEASE REWITHDEBINFO)
        SET(CMAKE_C_FLAGS_${i} "${CMAKE_C_FLAGS_${i}} /Qstd:c99")
      ENDFOREACH()
    ENDIF()
  ELSEIF(USING_CL)
    # MESSAGE("USING_CL is true.")
    ADD_DEFINITIONS(-DCL)
    IF(NOT BUILD_SHARED_LIBS AND NOT BUILD_WITH_SHARED_RUNTIME)
      SET(CMAKE_C_FLAGS_DEBUG "/D_DEBUG /MTd /Zi /Ob0 /Od /RTC1")
      SET(CMAKE_C_FLAGS_MINSIZEREL "/MT /O1 /Ob1 /D NDEBUG")
      SET(CMAKE_C_FLAGS_RELEASE "/MT /O2 /Ob2 /D NDEBUG")
      SET(CMAKE_C_FLAGS_RELWITHDEBINFO "/MT /Zi /O2 /Ob1 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_DEBUG "/D_DEBUG /MTd /Zi /Ob0 /Od /RTC1")
      SET(CMAKE_CXX_FLAGS_MINSIZEREL "/MT /O1 /Ob1 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_RELEASE "/MT /O2 /Ob2 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/MT /Zi /O2 /Ob1 /D NDEBUG")
    ELSE()
      SET(CMAKE_C_FLAGS_DEBUG "/D_DEBUG /MDd /Zi /Ob0 /Od /RTC1")
      SET(CMAKE_C_FLAGS_MINSIZEREL "/MD /O1 /Ob1 /D NDEBUG")
      SET(CMAKE_C_FLAGS_RELEASE "/MD /O2 /Ob2 /D NDEBUG")
      SET(CMAKE_C_FLAGS_RELWITHDEBINFO "/MD /Zi /O2 /Ob1 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_DEBUG "/D_DEBUG /MDd /Zi /Ob0 /Od /RTC1")
      SET(CMAKE_CXX_FLAGS_MINSIZEREL "/MD /O1 /Ob1 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_RELEASE "/MD /O2 /Ob2 /D NDEBUG")
      SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "/MD /Zi /O2 /Ob1 /D NDEBUG")
    ENDIF()
  ENDIF()
ENDIF()

