\documentclass[final]{siamltex}
\usepackage{amsmath}
\usepackage{graphicx}

%% autoscaled figures
\newcommand{\incfig}{\centering\includegraphics}
\setkeys{Gin}{width=0.7\linewidth,keepaspectratio}

\newcommand{\eqr}[1]{Eq.\thinspace(#1)}
\newcommand{\pfrac}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pfracc}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\newcommand{\pfraca}[1]{\frac{\partial}{\partial #1}}
\newcommand{\pfracb}[2]{\partial #1/\partial #2}
\newcommand{\pfracbb}[2]{\partial^2 #1/\partial #2^2}
\newcommand{\spfrac}[2]{{\partial_{#1}} {#2}}
\newcommand{\mvec}[1]{\mathbf{#1}}
\newcommand{\gvec}[1]{\boldsymbol{#1}}
\newcommand{\script}[1]{\mathpzc{#1}}
\newcommand{\eep}{\mvec{e}_\phi}
\newcommand{\eer}{\mvec{e}_r}
\newcommand{\eez}{\mvec{e}_z}
\newcommand{\iprod}[2]{\langle{#1}\rangle_{#2}}

\title{Consistency of discontinuous Galerkin discretizations of
  diffusion operators}
\author{A.~H. Hakim\footnotemark[2] 
   \and G.~W. Hammett\footnotemark[2]
   \and E.~Shi\footnotemark[2]\ \footnotemark[3]}

\begin{document}
\maketitle

\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\footnotetext[2]{Princeton Plasma Physics Laboratory, Princeton, NJ
  08543-0451.}%
\footnotetext[3]{Program in Plasma Physics, Department of Astrophysics,
  Princeton University, NJ}

\begin{abstract}
  Commonly used DG schemes for diffusion are inconsistent.
\end{abstract}

\begin{keywords} 
  Discontinuous Galerkin, diffusion equation, consistency, interface
  recovery, local discontinuous Galerkin, symmetric discontinuous
  Galerkin.
\end{keywords}

\begin{AMS}\end{AMS}

\pagestyle{myheadings}
\thispagestyle{plain}

\section{Introduction}

The discontinuous Galerkin (DG) method is a class of high-order
schemes for the numerical solution of partial differential equations
(PDEs). Developed originally for solving the linear, two-dimensional,
steady-state neutron transport equation\cite{reed-hill-1973}, these
schemes were extended to time-dependent, nonlinear, hyperbolic
PDEs\cite{Cockburn:2001vr}, and, subsequently, are now a leading
choice to achieve high-order solutions on complex geometries.

DG schemes are a generalization of finite-volume schemes: in addition
to evolving the cell averages, additional moments of the solution are
also evolved. Explicitly evolving moments eliminates the
``reconstruct'' and ``average'' steps in the standard finite-volume
Reconstruct-Evolve-Average (RAE) procedure\cite{leveque_book_2002} as
a high-order representation is already available in each cell. This
representation is expressed using basis functions local to a cell. In
this sense, the DG representation appears like a Finite-Element (FE)
method. However, unlike FE methods in which some degree of continuity
of the solution across cell boundaries is assumed, no such assumption
is made in DG schemes. In fact, similar to finite-volume schemes, the
jump across cell interfaces is used in an approximate or exact Riemann
solver to couple neighboring cells together and, with appropriate
choices, provide upwinding.

Although the jumps across cell interfaces serve as an important aspect
of DG schemes for hyperbolic equations, the presence of these
discontinuities can be an issue when discretizing second or higher
order operators using the DG framework. In particular, continuous
solution derivatives are needed at cell interfaces. As the solution
itself is discontinuous at cell interfaces, it is not clear how to
compute such derivatives.

At present there are three broad techniques for computing the solution
derivatives. The first is to introduce auxiliary variables to rewrite
the high-order PDE as a system of first-order PDEs, and use the DG
framework on the resulting larger system. This leads naturally to
estimates of solution derivatives at cell interfaces by particular
choices of numerical fluxes for the introduced auxiliary variables.
The second technique is to derive a weak-form of the PDE and introduce
special numerical fluxes, combined with ``penalty'' terms that
penalize the solution for being discontinuous across interfaces. These
two techniques are not completely independent, and, in some ways,
result from an attempt to apply ideas from FE methods to the DG
discretization. The third technique is to reconstruct a continuous
representation of the solution in the two cells sharing an interface
and use that instead to compute the needed derivatives. This approach
is closer in spirit to finite-volume methods in which solution
gradients at cell interfaces, needed in Navier-Stokes equations, for
example, are reconstructed using a least-square approach.

Although each of these techniques leads to satisfactory looking
solutions when used in solving PDEs, the question of
\emph{consistency} of the resulting schemes has not been addressed
before. By consistency we mean, intuitively, that as the cell size
goes to zero, the discrete representation of the high-order
\emph{operator} (and not just the solution at some later time)
recovers the exact operator. Our notion of full consistency is made
precise below.

In this paper we address the consistency of a few commonly used DG
discretizations of the diffusion operator in one-dimension. We show
that the widely used forms of local DG (LDG)
schemes\cite{Cockburn:1998uy} and penalty based methods, for example,
the symmetric variants of the direct DG schemes\cite{Liu:2010eq}, are
not fully consistent. We also show that van Leer and Nomura's recovery
DG approach\cite{vanLeer:2005kk}, is fully consistent. In addition to
consistency, we also perform von Neumann analysis of each of these
schemes and discuss the resulting eigenvalue spectrum. We point out
that that multiple eigenfunctions in DG schemes have a physical
interpretation as representing different wavelength modes, some of
which are shorter than the usual Nyquist limit wavelength of two
cells.

\section{Consistent discretizations}

In the discontinuous Galerkin scheme the discrete solution in a cell
$I_j\equiv [-x_j-\Delta x/2, x_j+\Delta x/2]$, is written as a sum
over polynomial basis functions. Using Legendre polynomials as modal
basis we can write
\begin{align}
  f(x) \approx f_{jh}(x) = \sum_{n=0}^N f_j^n P_n(\eta_j(x)),
  \qquad x \in I_j
\end{align}
where $f_j^n$ are expansion coefficients and $P_n(\eta)$ are Legendre
polynomials of degree $n$, and $\eta_j(x) = 2(x-x_j)/\Delta x$. The
expansion coefficient $f^0$ is the cell average, and the other
coefficients represent (combinations of) solution derivatives. For
example, for piecewise linear ($N=1$) basis functions, $2 f^1/\Delta
x$ is the solution slope. In fact, a linear transformation allows us
to write the expansion in a cell using Taylor series basis functions
centered around $x=x_j$
\begin{align}
  f_{jh}(x) = \sum_{n=0}^N f^{(n)}_j (x-x_j)^n/n!
\end{align}
where $f^{(n)}(x_j)$ is the $n$-th derivative evaluated at the cell
center, showing explicitly the relationship between expansion
coefficients and solution derivatives. 

Given a function $f(x)$, we call a discrete representation $f_{jh}$
\emph{consistent} if
\begin{align}
  \lim_{\Delta x \rightarrow 0} f_j^{(n)} = \frac{d^nf}{dx^n} \biggr|_{x_j}.
\end{align}
For example, the standard Galerkin procedure of minimization of the
error in each cell, $\int_{I_j} \big[f(x)-f_{jh}(x)\big]^2dx$, leads
to a consistent representation.

This concept of consistency can be extended to the approximation of
operators. Consider
\begin{align}
  g(x) = f_{xx}(x)
\end{align}
where subscripts represent derivatives. Given a domain $I\in[a,b]$
divided into uniform cells $I_j$, we wish to determine a discrete
representation of $g(x)$ using a DG scheme, i.e.
\begin{align}
  g(x) = f_{xx}(x) \approx g_{jh}(x) = \sum_{n=0}^N g_j^n P_n(\eta_j(x))
\end{align}
in each cell $I_j$. We define a discretization to be \emph{consistent
  in the mean} as follows
\begin{definition}[Consistency in the mean]
  A discrete DG representation, $g_{jh}(x)$, of $f_{xx}$ said to be
  \emph{consistent in the mean}, if
  \begin{align}
    \lim_{\Delta x\rightarrow 0} g_j^0 = f_{xx}|_{x_j}.
  \end{align}
\end{definition}

Consistency in the mean is required if the discrete operator is to be
represented correctly. However, for higher than piecewise constant
polynomial basis functions, the discrete operator also contains
estimates for derivatives of $f_{xx}$. Simply ensuring that the
discretization is consistent in the mean will not ensure that these
derivatives are computed correctly. Hence, we define a discretization
to be \emph{fully consistent} as follows
\begin{definition}[Full consistency]
  A discrete DG representation, $g_{jh}(x)$, of $f_{xx}$ said to be
  \emph{fully consistent}, if
  \begin{align}
    \lim_{\Delta x \rightarrow 0} \frac{d^ng_{jh}}{dx^n} =
    \frac{d^nf_{xx}}{dx^n} \biggr|_{x_j}
  \end{align}
for all $n=0,\ldots,N$.
\end{definition}

For example for piecewise linear basis functions, and a fully
consistent scheme $2g^1/\Delta x = d^3f/dx^3$. 

\section{Consistency of discontinuous Galerkin schemes for diffusion}

In this section we examine if widely used DG discretizations of
$g=f_{xx}$ are consistent.

\appendix

\section{Comparison of Scheme Convergence}
\begin{tabular}{c|c|c}
Scheme & k = 1 Order & k = 2 Order\\
\hline
ALDG & 4 & 6\\
SLDG & 2 & 4\\
SDDG & 2 & 4\\
RLDG & 4 & 8
\end{tabular}

\section{Symmetric Direct DG}
\begin{itemize}
  \item SDDG solves the following weak form:
    \begin{align*}
      \int_{I_j} u_t v \mathrm{d}x -\widehat{(u_x)}v\bigr|_{x_{j-\frac{1}{2}}}^{x_{j+\frac{1}{2}}}+\int_{I_j} u_x v_x \mathrm{d}x+ (\lbrack u\rbrack\widehat{v_x})_{j+\frac{1}{2}}^- + (\lbrack u\rbrack \widehat{v_x} )_{j-\frac{1}{2}} = & 0
    \end{align*}
	\item The flux is defined as:
    \begin{align*}
      \widehat{u_x} = & \beta_0 \frac{\lbrack u \rbrack}{\Delta x} + \overline{u_x} + \beta_1 \Delta x \lbrack u_{xx} \rbrack\\
      \widehat{v_x} = & \beta_0 \frac{\lbrack v \rbrack}{\Delta x} + \overline{v_x} + \beta_1 \Delta x \lbrack v_{xx} \rbrack
    \end{align*}
  \item $v$ is nonzero only inside the cell $I_j$, so only half of the terms contribute to the computation of $\widehat{v_x}$
  \item $\beta_0$ and $\beta_1$ have minimum values for an admissible numerical flux, and these limits are a function of the polynomial order used
  \item It appears that certain choices of $\beta_0$ and $\beta_1$ can make the scheme equivalent to the one obtained by averaging the update equations for the two choices of fluxes for local DG, but these choices might not satisfy the admissibility criteria
\end{itemize}
  
\subsection{k = 1}
$\left(\begin{array}{cc}
4\hat{T}^{-1} -8+4 \hat{T} & 3\hat{T}^{-1}-3 \hat{T} \\
-9 \hat{T}^{-1} +9 \hat{T} & -6 \hat{T}^{-1} -24-6 \hat{T}
\end{array}\right)$

Using $\beta_0 = 2$ and $\beta_1 = 0$
    
\subsection{k = 2}
$\left(
\begin{array}{ccc}
 3 \hat{T}^{-1}-6+3 \hat{T} & 2 \hat{T}^{-1}-2 \hat{T} & 3 \hat{T}^{-1}-6+3 \hat{T} \\
 -6 \hat{T}^{-1}+6 \hat{T} & -3 \hat{T}^{-1}-18-3 \hat{T} & -6 \hat{T}^{-1}+6 \hat{T} \\
 15 \hat{T}^{-1}-30+15 \hat{T} & 10 \hat{T}^{-1}-10 \hat{T} & 15 \hat{T}^{-1}-90+15 \hat{T} \\
\end{array}
\right)$

Using $\beta_0 = 3/2$ and $\beta_1 = 1/4$

$\left(
\begin{array}{ccc}
 9 \hat{T}^{-1}-18+9 \hat{T} & 8 \hat{T}^{-1} -8 \hat{T}& 6 \hat{T}^{-1}-12+6 \hat{T} \\
 -24 \hat{T}^{-1}+24 \hat{T} & -21 \hat{T}^{-1}-54-21 \hat{T} & -15 \hat{T}^{-1}15 \hat{T} \\
 30 \hat{T}^{-1}-60+30 \hat{T} & 25 \hat{T}^{-1}-25 \hat{T} & 15 \hat{T}^{-1}-90+15 \hat{T}
\end{array}
\right)$

Using $\beta_0 = 9/2$ and $\beta_1 = 0$

\section{Local DG}
\begin{itemize}
\item Local DG is done by solving the two equations:
\begin{align*}
w + \frac{\partial f}{\partial x} &= 0\\
\frac{\partial f}{\partial t} + \frac{\partial w}{\partial x} &= 0
\end{align*}
\item This form uses a three cell stencil, but will use a wider stencil if extended to the calculation of higher order derivatives.
\end{itemize}

\subsection{k = 1}
\subsection{Choice 1: $\hat{f} = f^+$ and $\hat{w} = w^-$}
$\left(
\begin{array}{cc}
 4\hat{T}^{-1} -8+4 \hat{T} & 2\hat{T}^{-1}+2-4 \hat{T} \\
 -12 \hat{T}^{-1} +6+6 \hat{T} & -6 \hat{T}^{-1} -24-6 \hat{T}
 \end{array}\right)$
 
 \subsubsection{Choice 2: $\hat{f} = f^-$ and $\hat{w} = w^+$}
 $\left(
\begin{array}{cc}
4\hat{T}^{-1} -8+4 \hat{T} & 4\hat{T}^{-1}-2-2 \hat{T} \\
-6 \hat{T}^{-1} -6+12 \hat{T} & -6 \hat{T}^{-1} -24-6 \hat{T}
\end{array}\right)$

\subsubsection{Symmetric Version}
$\left(\begin{array}{cc}
4\hat{T}^{-1} -8+4 \hat{T} & 3\hat{T}^{-1}-3 \hat{T} \\
-9 \hat{T}^{-1} +9 \hat{T} & -6 \hat{T}^{-1} -24-6 \hat{T}
\end{array}\right)$

\subsection{k = 2}
\subsubsection{Choice 1: $\hat{f} = f^+$ and $\hat{w} = w^-$}
$\left(
\begin{array}{ccc}
 -18+9 \hat{T}+9 \hat{T}^{-1}& 2-9 \hat{T}+7 \hat{T}^{-1}& -12+9 \hat{T}+3 \hat{T}^{-1}\\
 6+21 \hat{T}-27 \hat{T}^{-1}& -54-21 \hat{T}-21 \hat{T}^{-1}& 24+21 \hat{T}-9 \hat{T}^{-1}\\
 -60+15 \hat{T}+45 \hat{T}^{-1}& 40-15 \hat{T}+35 \hat{T}^{-1}& -90+15 \hat{T}+15 \hat{T}^{-1}
\end{array}
\right)$

\subsubsection{Choice 2: $\hat{f} = f^-$ and $\hat{w} = w^+$}
$\left(
\begin{array}{ccc}
 -18+9 \hat{T}+9 \hat{T}^{-1}& -2-7 \hat{T}+9 \hat{T}^{-1}& -12+3 \hat{T}+9 \hat{T}^{-1}\\
 -6+27 \hat{T}-21 \hat{T}^{-1}& -54-21 \hat{T}-21 \hat{T}^{-1}& -24+9 \hat{T}-21 \hat{T}^{-1}\\
 -60+45 \hat{T}+15 \hat{T}^{-1}& -40-35 \hat{T}+15 \hat{T}^{-1}& -90+15 \hat{T}+15 \hat{T}^{-1}
\end{array}
\right)$

\subsubsection{Symmetric Version}
$\left(
\begin{array}{ccc}
 9 \hat{T}^{-1}-18+9 \hat{T} & 8 \hat{T}^{-1} -8 \hat{T}& 6 \hat{T}^{-1}-12+6 \hat{T} \\
 -24 \hat{T}^{-1}+24 \hat{T} & -21 \hat{T}^{-1}-54-21 \hat{T} & -15 \hat{T}^{-1}15 \hat{T} \\
 30 \hat{T}^{-1}-60+30 \hat{T} & 25 \hat{T}^{-1}-25 \hat{T} & 15 \hat{T}^{-1}-90+15 \hat{T}
\end{array}
\right)$

\section{Interface Recovery}
  A second integration by parts is performed to give weak form
  \begin{align*}
    \int_{I_j} u_t v \mathrm{d}x 
    =
    \left(vf_x - v_xf\right) \bigr|_{x_{j-\frac{1}{2}}}^{x_{j+\frac{1}{2}}}
    +
    \int_{I_j}v_{xx}u\mathrm{d}x
  \end{align*}
  where $f(\zeta)$, $\zeta=x_{j-1/2}-x \in [-\Delta x,\Delta x]$, is a
  \emph{reconstructed} poynomial that extends across two cells
  and defined as
  \begin{align*}
    f(\zeta) = f_0 + \zeta f' + \frac{1}{2}\zeta^2 f'' + \ldots
  \end{align*}
  and
  \begin{align*}
    \int_{I_{j-1}} v f \mathrm{d}x &= \int_{I_{j-1}} v u \mathrm{d}x \\
    \int_{I_{j}} v f \mathrm{d}x &= \int_{I_{j}} v u \mathrm{d}x
  \end{align*}
  
  
  
  \subsection{k = 1}
  $\left(\begin{array}{cc}
      9\hat{T}-18+9\hat{T}^{-1} & -5\hat{T} + 5\hat{T}^{-1} \\
      15 \hat{T} -15 \hat{T}^{-1} & -7 \hat{T} - 46 - 7\hat{T}^{-1}
    \end{array}\right)$
    
  \subsection{k = 2}
  $\left(
\begin{array}{ccc}
 -18+9 \hat{T}+9 \hat{T}^{-1} & -8 \hat{T}+8 \hat{T}^{-1} & -12+6 \hat{T}+6 \hat{T}^{-1} \\
 24 \hat{T}-24 \hat{T}^{-1} & -54-21 \hat{T}-21 \hat{T}^{-1} & 15 \hat{T}-15 \hat{T}^{-1} \\
 -60+30 \hat{T}+30 \hat{T}^{-1} & -25 \hat{T}+25 \hat{T}^{-1} & -90+15 \hat{T}+15 \hat{T}^{-1}
\end{array}
\right)$



\bibliography{gke}
\bibliographystyle{siam}

\end{document}